const XP_REWARDS={completeAssessment:100,retakeAssessment:25,perfectAssessment:250,completeLesson:25,completeStripe:100,completeBelt:500,shareResults:50,dailyVisit:10,weekStreak:100,monthStreak:500,firstLook:50,knowThyself:200,honestLook:100,growthMindset:150};class XPSystem{constructor(){this.storageKey='tapinTotalXP';this.historyKey='tapinXPHistory';}getTotalXP(){return parseInt(localStorage.getItem(this.storageKey)||'0');}awardXP(amount,reason,source='general'){const currentXP=this.getTotalXP();const newXP=currentXP+amount;localStorage.setItem(this.storageKey,newXP.toString());this.recordXPHistory(amount,reason,source);this.triggerXPEvent(amount,reason,newXP);return newXP;}recordXPHistory(amount,reason,source){const history=this.getXPHistory();const entry={amount,reason,source,timestamp:Date.now(),date:new Date().toISOString()};history.push(entry);if(history.length>100){history.shift();}localStorage.setItem(this.historyKey,JSON.stringify(history));}getXPHistory(){return JSON.parse(localStorage.getItem(this.historyKey)||'[]');}getXPBySource(source){const history=this.getXPHistory();return history .filter(entry=>entry.source===source).reduce((sum,entry)=>sum+entry.amount,0);}getXPToday(){const history=this.getXPHistory();const today=new Date().toDateString();return history .filter(entry=>new Date(entry.timestamp).toDateString()===today).reduce((sum,entry)=>sum+entry.amount,0);}triggerXPEvent(amount,reason,totalXP){const event=new CustomEvent('xpGained',{detail:{amount,reason,totalXP}});window.dispatchEvent(event);}}const ACHIEVEMENTS={'first-look':{id:'first-look',name:'First Look',description:'Complete your first assessment',icon:'ðŸ‘€',xp:50,category:'discovery'},'know-thyself':{id:'know-thyself',name:'Know Thyself',description:'Complete all self-discovery assessments',icon:'ðŸ”®',xp:200,category:'discovery'},'belt-earned':{id:'belt-earned',name:'Belt Check',description:'Complete the Belt Check assessment',icon:'ðŸ¥‹',xp:100,category:'discovery'},'first-stripe':{id:'first-stripe',name:'First Stripe',description:'Earn your first belt stripe',icon:'âž–',xp:100,category:'training'},'first-belt-complete':{id:'first-belt-complete',name:'Belt Mastery',description:'Complete your first full belt',icon:'ðŸŽ–ï¸',xp:500,category:'training'},'all-belts':{id:'all-belts',name:'Black Belt Master',description:'Complete all five belts',icon:'ðŸ†',xp:2500,category:'training'},'week-warrior':{id:'week-warrior',name:'Week Warrior',description:'Train 7 days in a row',icon:'ðŸ”¥',xp:100,category:'engagement'},'month-warrior':{id:'month-warrior',name:'Month Warrior',description:'Train 30 days in a row',icon:'ðŸ’ª',xp:500,category:'engagement'},'honest-look':{id:'honest-look',name:'Honest Look',description:'Score below 50 and continue anyway',icon:'ðŸ’ª',xp:100,category:'character'},'growth-mindset':{id:'growth-mindset',name:'Growth Mindset',description:'Retake and improve an assessment score',icon:'ðŸ“ˆ',xp:150,category:'character'},'vulnerability-first':{id:'vulnerability-first',name:'Vulnerability First',description:'Complete White Belt',icon:'âšª',xp:300,category:'character'}};class AchievementSystem{constructor(){this.storageKey='tapinAchievements';this.xpSystem=new XPSystem();}getEarnedAchievements(){return JSON.parse(localStorage.getItem(this.storageKey)||'[]');}hasAchievement(achievementId){const earned=this.getEarnedAchievements();return earned.some(a=>a.id===achievementId);}unlockAchievement(achievementId){if(this.hasAchievement(achievementId)){return false;}const achievement=ACHIEVEMENTS[achievementId];if(!achievement){ return false;}const earned=this.getEarnedAchievements();earned.push({...achievement,unlockedAt:Date.now(),unlockedDate:new Date().toISOString()});localStorage.setItem(this.storageKey,JSON.stringify(earned));this.xpSystem.awardXP(achievement.xp,`Achievement:${achievement.name}`,'achievement');this.triggerAchievementEvent(achievement);return true;}getAchievementsByCategory(category){return Object.values(ACHIEVEMENTS).filter(a=>a.category===category);}getStats(){const earned=this.getEarnedAchievements();const total=Object.keys(ACHIEVEMENTS).length;return{earned:earned.length,total:total,percentage:Math.round((earned.length/total)*100),recentUnlocks:earned.slice(-5).reverse()};}triggerAchievementEvent(achievement){const event=new CustomEvent('achievementUnlocked',{detail:achievement});window.dispatchEvent(event);}}class StreakSystem{constructor(){this.storageKey='tapinStreak';this.xpSystem=new XPSystem();}getStreakData(){const defaultData={current:0,longest:0,lastVisit:null,visitDates:[]};const data=localStorage.getItem(this.storageKey);return data ? JSON.parse(data):defaultData;}recordVisit(){const data=this.getStreakData();const today=new Date().toDateString();if(data.lastVisit===today){return data;}const yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);const yesterdayStr=yesterday.toDateString();if(data.lastVisit===yesterdayStr){data.current+=1;}else if(data.lastVisit===null||data.lastVisit===today){data.current=1;}else{data.current=1;}if(data.current>data.longest){data.longest=data.current;}data.visitDates.push(today);if(data.visitDates.length>90){data.visitDates.shift();}data.lastVisit=today;localStorage.setItem(this.storageKey,JSON.stringify(data));this.xpSystem.awardXP(XP_REWARDS.dailyVisit,'Daily visit','streak');this.checkStreakAchievements(data.current);this.triggerStreakEvent(data);return data;}checkStreakAchievements(current){const achievementSystem=new AchievementSystem();if(current===7){achievementSystem.unlockAchievement('week-warrior');this.xpSystem.awardXP(XP_REWARDS.weekStreak,'7-day streak bonus','streak');}if(current===30){achievementSystem.unlockAchievement('month-warrior');this.xpSystem.awardXP(XP_REWARDS.monthStreak,'30-day streak bonus','streak');}}triggerStreakEvent(data){const event=new CustomEvent('streakUpdated',{detail:data});window.dispatchEvent(event);}}class BeltProgress{constructor(){this.belts=['white','blue','purple','brown','black'];}getOverallProgress(){const progress=this.belts.map(belt=>({belt,stripes:this.getStripesEarned(belt),totalStripes:4,assessmentComplete:this.isAssessmentComplete(belt),xp:this.getBeltXP(belt)}));return progress;}getStripesEarned(belt){const stripesKey=`${belt}StripesEarned`;const stripes=JSON.parse(localStorage.getItem(stripesKey)||'[]');return stripes.length;}isAssessmentComplete(belt){const assessmentKey=`${belt}BeltAssessmentComplete`;return localStorage.getItem(assessmentKey)==='true';}getBeltXP(belt){let totalXP=0;for(let i=1;i<=4;i++){const stripeKey=`${belt}beltStripe${i}ModuleXP`;totalXP+=parseInt(localStorage.getItem(stripeKey)||'0');}const assessmentKey=`${belt}BeltAssessmentXP`;totalXP+=parseInt(localStorage.getItem(assessmentKey)||'0');return totalXP;}getCurrentBelt(){const beltsEarned=JSON.parse(localStorage.getItem('beltsEarned')||'[]');if(beltsEarned.includes('black'))return 'black';if(beltsEarned.includes('brown'))return 'brown';if(beltsEarned.includes('purple'))return 'purple';if(beltsEarned.includes('blue'))return 'blue';return 'white';}getNextBelt(){const current=this.getCurrentBelt();const currentIndex=this.belts.indexOf(current);if(currentIndex===this.belts.length-1){return null;}return this.belts[currentIndex+1];}getTotalCompletion(){const progress=this.getOverallProgress();const totalPossible=this.belts.length*5;const completed=progress.reduce((sum,belt)=>{return sum+belt.stripes+(belt.assessmentComplete ? 1:0);},0);return Math.round((completed/totalPossible)*100);}}document.addEventListener('DOMContentLoaded',function(){const streakSystem=new StreakSystem();streakSystem.recordVisit();const isFirstVisit=!localStorage.getItem('tapinFirstVisit');if(isFirstVisit){localStorage.setItem('tapinFirstVisit',Date.now());}});window.TapInGamification={XPSystem,AchievementSystem,StreakSystem,BeltProgress,XP_REWARDS,ACHIEVEMENTS};