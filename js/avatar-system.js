const AVATAR_SYSTEM={beltColors:{'white':'#FFFFFF','blue':'#1e40af','purple':'#7c3aed','brown':'#92400e','black':'#1f2937'},xpLevels:[{level:1,xp:0,title:"Beginner"},{level:2,xp:100,title:"Apprentice"},{level:3,xp:250,title:"Practitioner"},{level:4,xp:500,title:"Skilled"},{level:5,xp:1000,title:"Dedicated"},{level:6,xp:1500,title:"Advanced"},{level:7,xp:2000,title:"Expert"},{level:8,xp:3000,title:"Elite"},{level:9,xp:4000,title:"Master"},{level:10,xp:5000,title:"Grand Master"},{level:11,xp:6000,title:"Champion"},{level:12,xp:7500,title:"Legend"},{level:13,xp:9000,title:"Sage"},{level:14,xp:11000,title:"Mentor"},{level:15,xp:13000,title:"Master Instructor"},{level:16,xp:15000,title:"Grand Master"},{level:17,xp:18000,title:"Legendary Master"},{level:18,xp:21000,title:"Supreme Master"},{level:19,xp:25000,title:"Ultimate Master"},{level:20,xp:30000,title:"Perfect Master"}],getCurrentBelt:function(){if(localStorage.getItem('blackBeltComplete')==='true')return 'black';if(localStorage.getItem('brownBeltComplete')==='true')return 'brown';if(localStorage.getItem('purpleBeltComplete')==='true')return 'purple';if(localStorage.getItem('blueBeltComplete')==='true')return 'blue';if(localStorage.getItem('whiteBeltComplete')==='true')return 'white';const assessment=localStorage.getItem('tapinBeltAssessment');if(assessment){try{const result=JSON.parse(assessment);if(result.belt){return result.belt.toLowerCase();}}catch(e){console.warn('Error parsing assessment result:',e);}}return 'white';},getTotalXP:function(){return parseInt(localStorage.getItem('totalXP'))||0;},getCurrentLevel:function(xp){for(let i=this.xpLevels.length-1;i>=0;i--){if(xp>=this.xpLevels[i].xp){return this.xpLevels[i];}}return this.xpLevels[0];},getNextLevelXP:function(currentLevel){const currentIndex=this.xpLevels.findIndex(l=>l.level===currentLevel);if(currentIndex<this.xpLevels.length-1){return this.xpLevels[currentIndex+1].xp;}return this.xpLevels[currentIndex].xp;},init:function(){const totalXP=this.getTotalXP();const currentBelt=this.getCurrentBelt();const currentLevel=this.getCurrentLevel(totalXP);const nextLevelXP=this.getNextLevelXP(currentLevel.level);const beltElement=document.getElementById('userBelt');if(beltElement){beltElement.style.fill=this.beltColors[currentBelt];beltElement.className='belt '+currentBelt+'-belt';}const beltNameElement=document.getElementById('avatarBeltName');if(beltNameElement){const beltName=currentBelt.charAt(0).toUpperCase()+currentBelt.slice(1);beltNameElement.textContent=`${beltName}Belt`;}const xpElement=document.getElementById('avatarXP');if(xpElement){xpElement.textContent=`${totalXP}/${nextLevelXP}XP`;}const levelElement=document.getElementById('avatarLevel');if(levelElement){levelElement.textContent=`Level ${currentLevel.level}:${currentLevel.title}`;}},update:function(){this.init();},checkLevelUp:function(){const totalXP=this.getTotalXP();const currentLevel=this.getCurrentLevel(totalXP);const lastLevel=parseInt(localStorage.getItem('lastKnownLevel'))||1;if(currentLevel.level>lastLevel){localStorage.setItem('lastKnownLevel',currentLevel.level.toString());this.showLevelUpCelebration(currentLevel);return true;}return false;},showLevelUpCelebration:function(level){const popup=document.createElement('div');popup.className='level-up-popup';popup.innerHTML=`<div class="level-up-content"><div class="level-up-icon">ðŸŽ‰</div><h2>Level Up!</h2><p class="level-up-level">Level ${level.level}</p><p class="level-up-title">${level.title}</p><div class="level-up-xp">+${level.level*10}XP Bonus!</div></div>`;document.body.appendChild(popup);if(typeof triggerConfetti==='function'){triggerConfetti();}setTimeout(()=>{popup.classList.add('show');},100);setTimeout(()=>{popup.classList.remove('show');setTimeout(()=>popup.remove(),500);},4000);}};document.addEventListener('DOMContentLoaded',function(){AVATAR_SYSTEM.init();AVATAR_SYSTEM.checkLevelUp();});window.AVATAR_SYSTEM=AVATAR_SYSTEM;